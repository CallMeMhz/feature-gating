<!-- Item 卡片组件 -->
<div class="space-y-3">
    <!-- Key 名称 -->
    <div>
        <div class="flex items-center justify-between mb-1">
            <label class="text-xs font-medium text-gray-700">Key <span class="text-red-500">*</span></label>
            <span class="text-xs text-gray-400">大小写不敏感</span>
        </div>
        <input 
            type="text" 
            x-model="item.name"
            @input="hasUnsavedChanges = true"
            :class="{
                'border-red-500 ring-1 ring-red-500': !item.name || !item.name.trim() || isDuplicateName(item.name, index) || !isValidKeyFormat(item.name),
                'border-gray-300': item.name && item.name.trim() && !isDuplicateName(item.name, index) && isValidKeyFormat(item.name)
            }"
            class="w-full px-2 py-1 text-sm border rounded focus:outline-none focus:ring-1 focus:ring-blue-500"
            placeholder="new_feature.v1"
        >
        <template x-if="!item.name || !item.name.trim()">
            <p class="text-red-500 text-xs mt-1">⚠️ Key 不能为空</p>
        </template>
        <template x-if="item.name && item.name.trim() && !isValidKeyFormat(item.name)">
            <p class="text-red-500 text-xs mt-1">⚠️ 只能包含小写字母、数字、-_.$#@</p>
        </template>
        <template x-if="item.name && item.name.trim() && isValidKeyFormat(item.name) && isDuplicateName(item.name, index)">
            <p class="text-red-500 text-xs mt-1">⚠️ Key 重复</p>
        </template>
    </div>
    
    <!-- 描述 -->
    <div>
        <label class="block text-xs font-medium text-gray-700 mb-1">描述</label>
        <textarea 
            x-model="item.description"
            @input="hasUnsavedChanges = true"
            rows="2"
            class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"
            placeholder="功能描述"
        ></textarea>
    </div>
    
    <!-- Enable/Disable 开关 -->
    <div class="flex items-center justify-between">
        <span class="text-xs font-medium text-gray-700">启用状态</span>
        <label class="relative inline-flex items-center cursor-pointer">
            <input 
                type="checkbox" 
                x-model="item.enabled"
                @change="hasUnsavedChanges = true"
                class="sr-only peer"
            >
            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
        </label>
    </div>
    
    <!-- 条件列表 -->
    <div>
        <div class="flex justify-between items-center mb-2">
            <label class="text-xs font-medium text-gray-700">条件</label>
            <button 
                @click="item.conditions.push({field: 'user_id', operator: '%', value: 10, comparator: '>', target: 1}); hasUnsavedChanges = true"
                class="text-blue-600 text-xs hover:text-blue-700"
            >
                + 添加
            </button>
        </div>
        
        <div class="space-y-2">
            <template x-for="(cond, idx) in item.conditions" :key="idx">
                <div class="p-2 bg-gray-50 rounded border border-gray-200 text-xs space-y-1">
                    <div class="flex items-center space-x-1">
                        <select x-model="cond.field" @change="hasUnsavedChanges = true" class="flex-1 px-1 py-1 border border-gray-300 rounded text-xs">
                            <option value="user_id">user_id</option>
                            <option value="chat_id">chat_id</option>
                        </select>
                        <button @click="item.conditions.splice(idx, 1); hasUnsavedChanges = true" class="text-red-500 hover:text-red-700">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-4 gap-1">
                        <select x-model="cond.operator" @change="hasUnsavedChanges = true" class="px-1 py-1 border border-gray-300 rounded text-xs">
                            <option value="%">%</option>
                            <option value="/">/</option>
                            <option value="//">//</option>
                            <option value="*">*</option>
                        </select>
                        <input type="number" x-model.number="cond.value" @input="hasUnsavedChanges = true" class="px-1 py-1 border border-gray-300 rounded text-xs">
                        <select x-model="cond.comparator" @change="hasUnsavedChanges = true" class="px-1 py-1 border border-gray-300 rounded text-xs">
                            <option value=">">></option>
                            <option value="<"><</option>
                            <option value=">=">=</option>
                            <option value="<="><=</option>
                            <option value="==">=</option>
                            <option value="!=">!=</option>
                        </select>
                        <input type="number" x-model.number="cond.target" @input="hasUnsavedChanges = true" class="px-1 py-1 border border-gray-300 rounded text-xs">
                    </div>
                    
                    <div class="text-xs text-gray-500">
                        hash(<span x-text="cond.field"></span>) <span x-text="cond.operator"></span> <span x-text="cond.value"></span> <span x-text="cond.comparator"></span> <span x-text="cond.target"></span>
                    </div>
                </div>
            </template>
        </div>
    </div>
    
    <!-- 删除按钮 -->
    <button 
        @click="if(confirm('确定删除此 Item？')) { items.splice(index, 1); hasUnsavedChanges = true; }"
        class="w-full py-1 px-2 text-xs text-red-600 border border-red-600 rounded hover:bg-red-50"
    >
        删除此 Item
    </button>
</div>
