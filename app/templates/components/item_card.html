<!-- Item Âç°ÁâáÁªÑ‰ª∂ -->
<div class="space-y-3">
    <!-- Key ÂêçÁß∞ -->
    <div>
        <div class="flex items-center justify-between mb-1">
            <label class="text-xs font-medium text-gray-700">Key <span class="text-red-500">*</span></label>
            <span class="text-xs text-gray-400">Â§ßÂ∞èÂÜô‰∏çÊïèÊÑü</span>
        </div>
        <input 
            type="text" 
            x-model="item.name"
            @input="hasUnsavedChanges = true"
            :class="{
                'border-red-500 ring-1 ring-red-500': !item.name || !item.name.trim() || isDuplicateName(item.name, index) || !isValidKeyFormat(item.name),
                'border-gray-300': item.name && item.name.trim() && !isDuplicateName(item.name, index) && isValidKeyFormat(item.name)
            }"
            class="w-full px-2 py-1 text-sm border rounded focus:outline-none focus:ring-1 focus:ring-blue-500"
            placeholder="new_feature.v1"
        >
        <template x-if="!item.name || !item.name.trim()">
            <p class="text-red-500 text-xs mt-1">‚ö†Ô∏è Key ‰∏çËÉΩ‰∏∫Á©∫</p>
        </template>
        <template x-if="item.name && item.name.trim() && !isValidKeyFormat(item.name)">
            <p class="text-red-500 text-xs mt-1">‚ö†Ô∏è Âè™ËÉΩÂåÖÂê´Â∞èÂÜôÂ≠óÊØç„ÄÅÊï∞Â≠ó„ÄÅ-_.$#@</p>
        </template>
        <template x-if="item.name && item.name.trim() && isValidKeyFormat(item.name) && isDuplicateName(item.name, index)">
            <p class="text-red-500 text-xs mt-1">‚ö†Ô∏è Key ÈáçÂ§ç</p>
        </template>
    </div>
    
    <!-- ÊèèËø∞ -->
    <div>
        <label class="block text-xs font-medium text-gray-700 mb-1">ÊèèËø∞</label>
        <textarea 
            x-model="item.description"
            @input="hasUnsavedChanges = true"
            rows="2"
            class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"
            placeholder="ÂäüËÉΩÊèèËø∞"
        ></textarea>
    </div>
    
    <!-- Enable/Disable ÂºÄÂÖ≥ -->
    <div class="flex items-center justify-between">
        <span class="text-xs font-medium text-gray-700">ÂêØÁî®Áä∂ÊÄÅ</span>
        <label class="relative inline-flex items-center cursor-pointer">
            <input 
                type="checkbox" 
                x-model="item.enabled"
                @change="hasUnsavedChanges = true"
                class="sr-only peer"
            >
            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
        </label>
    </div>
    
    <!-- Êù°‰ª∂ÂàóË°® -->
    <div>
        <div class="flex justify-between items-center mb-2">
            <label class="text-xs font-medium text-gray-700">Êù°‰ª∂</label>
            <div class="relative" x-data="{showMenu: false}">
                <button 
                    @click="showMenu = !showMenu"
                    class="text-blue-600 text-xs hover:text-blue-700"
                >
                    + Ê∑ªÂä†
                </button>
                <div 
                    x-show="showMenu" 
                    @click.away="showMenu = false"
                    x-cloak
                    class="absolute right-0 mt-1 w-40 bg-white border border-gray-200 rounded shadow-lg z-10 text-xs"
                >
                    <button @click="item.conditions.push({field: 'user_id', operator: '%', value: 10, comparator: '>', target: 1}); hasUnsavedChanges = true; showMenu = false" class="block w-full text-left px-3 py-2 hover:bg-gray-100">ÂìàÂ∏åÁÅ∞Â∫¶</button>
                    <button @click="item.conditions.push({field: 'user_id', operator: '==', value: ''}); hasUnsavedChanges = true; showMenu = false" class="block w-full text-left px-3 py-2 hover:bg-gray-100">Áõ¥Êé•Áõ∏Á≠â ==</button>
                    <button @click="item.conditions.push({field: 'user_id', operator: '!=', value: ''}); hasUnsavedChanges = true; showMenu = false" class="block w-full text-left px-3 py-2 hover:bg-gray-100">Áõ¥Êé•‰∏çÁ≠â !=</button>
                    <button @click="item.conditions.push({field: 'user_id', operator: 'in', value: ''}); hasUnsavedChanges = true; showMenu = false" class="block w-full text-left px-3 py-2 hover:bg-gray-100">ÁôΩÂêçÂçï in</button>
                    <button @click="item.conditions.push({field: 'user_id', operator: 'not in', value: ''}); hasUnsavedChanges = true; showMenu = false" class="block w-full text-left px-3 py-2 hover:bg-gray-100">ÈªëÂêçÂçï not in</button>
                </div>
            </div>
        </div>
        
        <div class="space-y-2">
            <template x-for="(cond, idx) in item.conditions" :key="idx">
                <div class="p-2 bg-gray-50 rounded border border-gray-200 text-xs space-y-1">
                    <!-- Â≠óÊÆµÈÄâÊã©ÂíåÂà†Èô§ÊåâÈíÆ -->
                    <div class="flex items-center space-x-1">
                        <select x-model="cond.field" @change="hasUnsavedChanges = true" class="flex-1 px-1 py-1 border border-gray-300 rounded text-xs">
                            <option value="user_id">user_id</option>
                            <option value="chat_id">chat_id</option>
                        </select>
                        <button @click="item.conditions.splice(idx, 1); hasUnsavedChanges = true" class="text-red-500 hover:text-red-700">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Êìç‰ΩúÁ¨¶ÈÄâÊã© -->
                    <div>
                        <select x-model="cond.operator" @change="hasUnsavedChanges = true" class="w-full px-1 py-1 border border-gray-300 rounded text-xs">
                            <optgroup label="ÂìàÂ∏åÁÅ∞Â∫¶">
                                <option value="%">% (ÂèñÊ®°)</option>
                                <option value="/">/  (Èô§Ê≥ï)</option>
                                <option value="//">//  (Êï¥Èô§)</option>
                                <option value="*">*  (‰πòÊ≥ï)</option>
                            </optgroup>
                            <optgroup label="ÁôΩÂêçÂçïÊú∫Âà∂">
                                <option value="==">== (Áõ¥Êé•Áõ∏Á≠â)</option>
                                <option value="!=">!= (Áõ¥Êé•‰∏çÁ≠â)</option>
                                <option value="in">in (ÁôΩÂêçÂçï)</option>
                                <option value="not in">not in (ÈªëÂêçÂçï)</option>
                            </optgroup>
                        </select>
                    </div>
                    
                    <!-- ÂìàÂ∏åËøêÁÆóÁ±ªÂûãÔºöÊòæÁ§∫ 4 ‰∏™ËæìÂÖ•Ê°Ü -->
                    <template x-if="['%', '/', '//', '*'].includes(cond.operator)">
                        <div>
                            <div class="grid grid-cols-4 gap-1">
                                <input type="number" x-model.number="cond.value" @input="hasUnsavedChanges = true" class="px-1 py-1 border border-gray-300 rounded text-xs" placeholder="ÂÄº">
                                <select x-model="cond.comparator" @change="hasUnsavedChanges = true" class="px-1 py-1 border border-gray-300 rounded text-xs">
                                    <option value=">">></option>
                                    <option value="<"><</option>
                                    <option value=">=">=</option>
                                    <option value="<="><=</option>
                                    <option value="==">=</option>
                                    <option value="!=">!=</option>
                                </select>
                                <input type="number" x-model.number="cond.target" @input="hasUnsavedChanges = true" class="px-1 py-1 border border-gray-300 rounded text-xs" placeholder="ÁõÆÊ†á">
                                <div class="text-xs text-gray-500 col-span-4">
                                    hash(<span x-text="cond.field"></span>) <span x-text="cond.operator"></span> <span x-text="cond.value"></span> <span x-text="cond.comparator"></span> <span x-text="cond.target"></span>
                                </div>
                            </div>
                        </div>
                    </template>
                    
                    <!-- Áõ¥Êé•ÊØîËæÉÁ±ªÂûãÔºöÊòæÁ§∫‰∏Ä‰∏™ÂÄºËæìÂÖ•Ê°Ü -->
                    <template x-if="['==', '!='].includes(cond.operator)">
                        <div>
                            <input 
                                type="text" 
                                x-model="cond.value" 
                                @input="hasUnsavedChanges = true" 
                                class="w-full px-2 py-1 border border-gray-300 rounded text-xs" 
                                placeholder="‰æãÂ¶ÇÔºöuid_8555"
                            >
                            <div class="text-xs text-gray-500 mt-1">
                                <span x-text="cond.field"></span> <span x-text="cond.operator"></span> '<span x-text="cond.value"></span>'
                            </div>
                        </div>
                    </template>
                    
                    <!-- ÁôΩÂêçÂçï/ÈªëÂêçÂçïÁ±ªÂûãÔºöÊòæÁ§∫ÊñáÊú¨Âå∫Âüü -->
                    <template x-if="['in', 'not in'].includes(cond.operator)">
                        <div>
                            <textarea 
                                x-model="cond.value" 
                                @input="hasUnsavedChanges = true" 
                                rows="3"
                                class="w-full px-2 py-1 border border-gray-300 rounded text-xs font-mono" 
                                placeholder="ÊØèË°å‰∏Ä‰∏™IDÔºåÊàñÁî®ÈÄóÂè∑ÂàÜÈöî&#10;‰æãÂ¶ÇÔºö&#10;uid_1&#10;uid_2&#10;uid_3"
                            ></textarea>
                            <div class="text-xs text-gray-400 mt-1">
                                üí° ÊîØÊåÅÊØèË°å‰∏Ä‰∏™IDÔºåÊàñÁî®ÈÄóÂè∑ÂàÜÈöî
                            </div>
                            <div class="text-xs text-gray-500 mt-1">
                                <span x-text="cond.field"></span> <span x-text="cond.operator"></span> [<span x-text="typeof cond.value === 'string' ? cond.value.split(/[\n,]/).filter(v => v.trim()).length : cond.value.length"></span> ‰∏™]
                            </div>
                        </div>
                    </template>
                </div>
            </template>
        </div>
    </div>
    
    <!-- Âà†Èô§ÊåâÈíÆ -->
    <button 
        @click="if(confirm('Á°ÆÂÆöÂà†Èô§Ê≠§ ItemÔºü')) { items.splice(index, 1); hasUnsavedChanges = true; }"
        class="w-full py-1 px-2 text-xs text-red-600 border border-red-600 rounded hover:bg-red-50"
    >
        Âà†Èô§Ê≠§ Item
    </button>
</div>
